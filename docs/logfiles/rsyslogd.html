<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Syslog &mdash; Linux server mitigations</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Backups" href="../backups/README.html" />
    <link rel="prev" title="Path of a common intruder" href="Path-of-a-common-intruder.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Linux server mitigations
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Separation and isolation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../separation/README.html">Separation and isolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../separation/Chroot-jails.html">Chroot jails</a></li>
<li class="toctree-l1"><a class="reference internal" href="../separation/Communication.html">Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../separation/Docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../separation/FreeBSD-jails.html">FreeBSD jails</a></li>
<li class="toctree-l1"><a class="reference internal" href="../separation/KVM.html">KVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../separation/Services-audit.html">Services audit</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SSH</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ssh/README.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/Authentication-error.html">Authentication error</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/ForwardAgent.html">ForwardAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/Harden-ssh-server.html">Harden ssh server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/Installing-SSH.html">Installing SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/Jumping-hosts.html">Jumping hosts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/Keeping-current.html">Keeping current</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/Key-management.html">Key management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/ProxyCommand.html">ProxyCommand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh/ProxyJump.html">ProxyJump</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VPN</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vpn/README.html">VPN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vpn/OpenVPN.html">OpenVPN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vpn/strongSwan.html">strongSwan</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VNC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vnc/README.html">VNC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vnc/Connection-refused.html">Connection refused</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vnc/Securing-sessions.html">Securing sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vnc/TigerVNC.html">TigerVNC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vnc/TightVNC.html">TightVNC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Public key infrastructure (PKI)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pki/README.html">PKI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pki/Internal-PKI.html">Internal PKI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pki/Lets-Encrypt.html">Let’s Encrypt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pki/PAM.html">Pluggable Authentication Modules (PAM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pki/Problems.html">Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pki/TLS-SSL.html">TLS/SSL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Logfiles</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Logfiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Centralised-logging.html">Centralised logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logrotate.html">Logrotate</a></li>
<li class="toctree-l1"><a class="reference internal" href="Path-of-a-common-intruder.html">Path of a common intruder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Syslog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../backups/README.html">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backups/Simple-script.html">Simple script</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HIDS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ids/README.html">HIDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ids/Maltrail.html">Maltrail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ids/Samhain.html">Samhain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ids/Snort.html">Snort</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Firewall</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firewall/README.html">Firewalls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/Blacklists.html">Blacklists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/Fail2ban.html">Fail2ban</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/FireHOL.html">FireHOL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/FirewallD.html">FirewallD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/IPTables.html">IPTables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/NFTables.html">NFTables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/PF.html">Packet filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/Port-spoofing.html">Port spoofing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/SSHguard.html">SSHguard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/UFW.html">UFW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firewall/WAF.html">Web Application Firewall WAF</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Healthy SA habits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../habits/README.html">Healthy habits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../habits/Chattr.html">Chattr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../habits/Plain-language.html">Plain language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../habits/Puppet.html">Puppet</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All mitigations</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://tymyrddin.github.io/mitigations/">Overview</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Linux server mitigations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Syslog</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/logfiles/rsyslogd.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="syslog">
<h1>Syslog<a class="headerlink" href="#syslog" title="Permalink to this heading"></a></h1>
<p>The rsyslogd service is a system utility providing support for message logging. Support of both internet and unix domain sockets enables this utility to be used for remote and local logging. <a class="reference external" href="https://www.rsyslog.com/">Rsyslog</a> is a multi-threaded implementation of syslogd. It is by default installed on Ubuntu, Debian, OpenSUSE and CentOS, next to systemd’s journald.</p>
<ul class="simple">
<li><p>A combined audit system for linux</p></li>
<li><p>Allows for local and remote log collection. Remote logging makes day-to-day maintenance and incident response easier, log storage more secure, auditing more effective and analysis easier across multiple platforms.</p></li>
<li><p>Allows for a single point of management</p></li>
<li><p>Controlled per device in <code class="docutils literal notranslate"><span class="pre">/etc/syslog.conf</span></code></p></li>
<li><p>All reported messages are collected in a message file</p></li>
<li><p>Log replication can copy the audit data to multiple remote-logging hosts</p></li>
<li><p>It is recommended to also setup logrotate and compression.</p></li>
</ul>
<section id="setting-it-up">
<h2>Setting it up<a class="headerlink" href="#setting-it-up" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Set up a separate server for only logging purposes.</p></li>
<li><p>Keep it in a secure location behind a (physical) firewall.</p></li>
<li><p>Have no unnecessary services running on it.</p></li>
<li><p>Delete all other user accounts.</p></li>
<li><p>Add two snort boxes (IDS) that are actually syslog servers (yet have no IP address) and copy each packet intended for syslog server. With two boxes doing that independently from one another, court cases can be very convincingly supported. <strong>Thank you, Dean Bushmiller, that is a very, very good idea</strong>.</p>
<ul>
<li><p>Promiscuous mode</p></li>
<li><p>Rule: Only listen for this IP address on this port (of syslog server)</p></li>
</ul>
</li>
</ul>
</section>
<section id="server">
<h2>Server<a class="headerlink" href="#server" title="Permalink to this heading"></a></h2>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># apt install rsyslog
</pre></div>
</div>
<p>Start the service, enable it to auto-start at boot and check status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl start rsyslog
# systemctl enable rsyslog
# systemctl status rsyslog
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>Configuring <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code> involves setting up input sources (where rsyslog receives logs), and destination rules for where and how logs are written. Rsyslog uses RainerScript for its configuration syntax.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># vi /etc/rsyslog.conf
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code> uses the imjournal (importing structured log messages from systemd journal) and imusock modules (accepting syslog messages from applications running on the local system via Unix sockets). To configure it as a network and central logging server, the protocol (either UDP or TCP or both) it will use for remote syslog reception and the port it listens on must be configured.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ModLoad imudp
$UDPServerRun &lt;port&gt;

$ModLoad imtcp
$InputTCPServerRun &lt;port&gt;
</pre></div>
</div>
<p>Define the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">rules</span> <span class="pre">for</span> <span class="pre">processing</span> <span class="pre">the</span> <span class="pre">remote</span> <span class="pre">logs</span></code>. There be <a class="reference external" href="https://www.rsyslog.com/doc/v8-stable/configuration/templates.html">Templates</a>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$template RemoteLogs,&quot;/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log&quot;
*.* ?RemoteLogs 
&amp; ~
</pre></div>
</div>
<ul class="simple">
<li><p>Gather and write the received remote messages to distinct logs under <code class="docutils literal notranslate"><span class="pre">/var/log/remote/</span></code>, based on the hostname client machine name and remote client application that generated the messages as defined in the RemoteLogs template.</p></li>
<li><p>Record messages from all applications at all severity levels using the RemoteLogs template configuration.</p></li>
<li><p>Stop processing the messages once it is written to a file. If not set, it would be written to the local files.</p></li>
</ul>
<p>OR for example, for allowing all hosts (but not applications) in a subnet XXX.XXX.XXX.XXX/24 to log to the machine, using only UDP.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ModLoad imudp
$UDPServerRun &lt;port&gt;
$AllowedSender UDP, XXX.XXX.XXX.XXX/24

$template RemoteStore, &quot;/var/log/remote/%HOSTNAME%/%timegenerated:1:10:date-rfc3339%&quot;
:source, !isequal, &quot;localhost&quot; -?RemoteStore
</pre></div>
</div>
<p>:   source, isequal, “last” ~</p>
<p>Write and quit. Restart <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code> daemon:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl restart rsyslog
</pre></div>
</div>
</section>
</section>
<section id="clients">
<h2>Clients<a class="headerlink" href="#clients" title="Permalink to this heading"></a></h2>
<p>Install <code class="docutils literal notranslate"><span class="pre">rsyslog</span></code>, and edit <code class="docutils literal notranslate"><span class="pre">/etc/rsyslog.conf</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*.*   @XXX.XXX.XXX.XXX:&lt;port&gt;
</pre></div>
</div>
</section>
<section id="configuration-resources">
<h2>Configuration resources<a class="headerlink" href="#configuration-resources" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.rsyslog.com/">rsyslog</a></p></li>
<li><p><a class="reference external" href="https://help.papertrailapp.com/kb/configuration/configuring-remote-syslog-from-unixlinux-and-bsdos-x/">Configuring remote syslog from Unix/Linux and BSD/macOS</a></p></li>
<li><p><a class="reference external" href="https://help.papertrailapp.com/kb/configuration/configuring-remote-syslog-from-windows/">Configuring remote syslog from Windows</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Path-of-a-common-intruder.html" class="btn btn-neutral float-left" title="Path of a common intruder" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../backups/README.html" class="btn btn-neutral float-right" title="Backups" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
        <a href="https://unseen-uni.netlify.app/">Unseen University</a>, 2022

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>